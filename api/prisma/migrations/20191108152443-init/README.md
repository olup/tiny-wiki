# Migration `20191108152443-init`

This migration has been generated by loup topalian at 11/8/2019, 3:24:43 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "lift"."User" (
  "email" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT    ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Role" (
  "locked" BOOLEAN NOT NULL DEFAULT false  ,
  "slug" TEXT NOT NULL   ,
  PRIMARY KEY ("slug")
);

CREATE TABLE "lift"."Page" (
  "content" TEXT    ,
  "draftOwner" TEXT    REFERENCES "User"(id) ON DELETE SET NULL,
  "id" TEXT NOT NULL   ,
  "published" BOOLEAN NOT NULL DEFAULT false  ,
  "slug" TEXT NOT NULL DEFAULT ''  ,
  "title" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."_RoleToUser" (
  "A" TEXT    REFERENCES "Role"(slug) ON DELETE CASCADE,
  "B" TEXT    REFERENCES "User"(id) ON DELETE CASCADE
);

CREATE TABLE "lift"."_users_can_view_pages" (
  "A" TEXT    REFERENCES "Page"(id) ON DELETE CASCADE,
  "B" TEXT    REFERENCES "Role"(slug) ON DELETE CASCADE
);

CREATE TABLE "lift"."_users_can_edit_pages" (
  "A" TEXT    REFERENCES "Page"(id) ON DELETE CASCADE,
  "B" TEXT    REFERENCES "Role"(slug) ON DELETE CASCADE
);

CREATE TABLE "lift"."_Parents" (
  "A" TEXT    REFERENCES "Page"(id) ON DELETE CASCADE,
  "B" TEXT    REFERENCES "Page"(id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX "lift"."User.id" ON "User"("id")

CREATE UNIQUE INDEX "lift"."User.email" ON "User"("email")

CREATE UNIQUE INDEX "lift"."Role.slug" ON "Role"("slug")

CREATE UNIQUE INDEX "lift"."Page.id" ON "Page"("id")

CREATE UNIQUE INDEX "lift"."Page.slug" ON "Page"("slug")

CREATE UNIQUE INDEX "lift"."_RoleToUser_AB_unique" ON "_RoleToUser"("A","B")

CREATE UNIQUE INDEX "lift"."_users_can_view_pages_AB_unique" ON "_users_can_view_pages"("A","B")

CREATE UNIQUE INDEX "lift"."_users_can_edit_pages_AB_unique" ON "_users_can_edit_pages"("A","B")

CREATE UNIQUE INDEX "lift"."_Parents_AB_unique" ON "_Parents"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191108152443-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,45 @@
+datasource db {
+  provider = "sqlite"
+  url      = "file:../db/dev.db"
+  default  = true
+}
+
+generator photon {
+  provider = "photonjs"
+}
+
+generator nexus_prisma {
+  provider = "nexus-prisma"
+}
+
+model User {
+  id     String  @default(cuid()) @id @unique
+  email  String  @unique
+  name   String?
+  roles  Role[]
+  drafts Page[]  @relation(name: "draftOwner")
+}
+
+model Role {
+  slug      String  @default(cuid()) @id @unique
+  users     User[]
+  locked    Boolean @default(false)
+  viewPages Page[]  @relation(name: "users_can_view_pages")
+  editPages Page[]  @relation(name: "users_can_edit_pages")
+}
+
+
+model Page {
+  id         String  @default(cuid()) @id @unique
+  title      String
+  slug       String  @unique
+  content    String?
+  published  Boolean
+  draftOwner User?   @relation(name: "draftOwner")
+
+  canView Role[] @relation(name: "users_can_view_pages")
+  canEdit Role[] @relation(name: "users_can_edit_pages")
+
+  parents  Page[] @relation("Parents")
+  children Page[] @relation("Parents")
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191108152443-init)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191108152443-init'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
